const localLocation=document.getElementById("location"),stateTemperature=document.getElementById("state"),button=document.getElementById("button"),card=document.getElementById("card"),cardImg=document.querySelector(".card-img-top");let url,data,temperature,sunsetTime,sunriseTime,tempFahrenheit,localPosition,latitude,longitude,img=document.querySelector("img");const getLocation=()=>{return new Promise(function(e,t){navigator.geolocation.getCurrentPosition(n=>{navigator.geolocation?e(localPosition=n):t(console.log("pas compatible"))})})},assignPosition=()=>{return new Promise(function(e,t){latitude=localPosition.coords.latitude.toFixed(2),longitude=localPosition.coords.longitude.toFixed(2),e("localPosition")})};let generateUrl=()=>{return new Promise(function(e,t){e(url=`https://fcc-weather-api.glitch.me/api/current?lat=${latitude}&lon=${longitude}`)})};const request=e=>new Promise(function(t,n){const o=new XMLHttpRequest;o.onreadystatechange=function(e){if(4===o.readyState)if(200===o.status){if(t(o.response),"Shuzenji"===(data=JSON.parse(o.responseText)).name)return location.reload()}else n(o.status)},o.ontimeout=function(){n("timeout")},o.open("get",e,!0),o.send()}),convertToFahrenheit=()=>{tempFahrenheit=(1.8*temperature+32).toString().slice(0,4)},infoUi=()=>{return new Promise(function(e,t){temperature=data.main.temp.toString().slice(0,4),localLocation.innerText=`${data.name}, ${data.sys.country}`,stateTemperature.innerText=`${temperature}°C`,sunsetTime=data.sys.sunset,sunriseTime=data.sys.sunrise,e(sunsetTime)})},compareSunsetTime=()=>{return new Promise(function(e,t){let n=(new Date).getTime().toString().slice(0,10);(n=parseInt(n))>sunsetTime||n<sunriseTime?nightUi():dayUi(),e(n)})},dayUi=()=>{switch(data.weather[0].description){case"broken clouds":case"scattered clouds":img.src="http://svgshare.com/i/4E6.svg";break;case"clouds":img.src="http://svgshare.com/i/4GW.svg";break;case"few clouds":img.src="http://svgshare.com/i/4L1.svg";break;case"shower rain":img.src="http://svgshare.com/i/4G0.svg";break;case"thunderstorm with rain":img.src="https://svgshare.com/i/5oa.svg";break;case"mist":img.src="http://svgshare.com/i/4GW.svg";break;case"clear sky":default:img.src="https://svgshare.com/i/5ob.svg"}},nightUi=()=>{img.src="http://svgshare.com/i/4FW.svg",card.style.backgroundColor="#02475e",cardImg.style.backgroundColor="#02475e"};button.addEventListener("click",()=>{"FAHRENHEIT"===button.innerText?(tempFahrenheit=(1.8*temperature+32).toString().slice(0,4),state.innerText=`${tempFahrenheit}°F`,button.innerText="CELSIUS"):"CELSIUS"===button.innerText&&(button.innerText="FAHRENHEIT",state.innerText=`${temperature}°C`)}),new Promise(function(e,t){navigator.geolocation.getCurrentPosition(n=>{navigator.geolocation?e(localPosition=n):t(console.log("pas compatible"))})}).then(assignPosition).then(generateUrl).then(request).then(infoUi).then(compareSunsetTime);